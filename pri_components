-- =====================================================
-- Pipeline Risk Index (PRI) Components
-- =====================================================

-- -----------------------------------------------------
-- Sales Cycle Risk Score
-- -----------------------------------------------------
CASE
  WHEN Deal_Age_Days > Avg_Sales_Cycle_Won THEN 1
  ELSE 0
END

-- -----------------------------------------------------
-- Deal Size Risk Score
-- -----------------------------------------------------
CASE
  WHEN Amount > AVG(Amount) THEN 0.5
  ELSE 0
END

-- -----------------------------------------------------
-- Forecast Confidence Risk Score
-- -----------------------------------------------------
CASE
  WHEN Probability < Win_Rate THEN 1
  ELSE 0
END

-- -----------------------------------------------------
-- Recency Risk Score
-- -----------------------------------------------------
CASE
  WHEN DATEDIFF('day', LastModifiedDate, TODAY()) > 14 THEN 1
  ELSE 0
END
